language: java
services:
  - redis-server
  - elasticsearch

before_install:
- git config --global user.name "Goodow Bot"
- git config --global user.email "dev@goodow.com"
- cd bower-realtime-store && git pull origin master && git remote set-url origin "https://${GH_TOKEN}@github.com/goodow/bower-realtime-store.git"
- cd ${TRAVIS_BUILD_DIR}
- wget -P target/travis https://raw.githubusercontent.com/goodow/maven/master/settings.xml

script:
- mvn test -B
- ./gwt-compile.sh

after_success:
- cd bower-realtime-store && git commit -a -m "Generated by goodow/realtime-store@${TRAVIS_COMMIT}" && git push origin HEAD:master
- cd ${TRAVIS_BUILD_DIR}
- '[ ${TRAVIS_PULL_REQUEST} = ''false'' ] && mvn deploy -Psonatype-oss-release -Dgpg.skip=true
  --settings target/travis/settings.xml || mvn verify --settings target/travis/settings.xml'

env:
  global:
    - secure: Rh107B0itGe9obAmRKPpaUWjy7xja13lcHiCK3vHTmKkyBZBSS5hdwBzLFWUWekTyC+vjXD0Kah3QjYNAy3Q6JqpgAVwO8qnGjorV6sBSeIka6gG+iMY5auFGhfTGTKg7sUb9c3xD2FJ5t9/uI6xO+aN5tIrYXDP6P1WXkKBbcg=
    - secure: NbOTUwc3Lc5kDuHH9XLpyTMkhyln4E3k1MZZNiv9HtteQPpZ/zuDieZiLz5+Iy2p7kL2JVHa1zas45ooUfMx2HYj7qQfUKijmCzWi4kaMVcuQOZI5uZYdLiUulaOWxqZ2dWB2hOw5Jr2jFExxGNLu1bofcbE07SBdZ5fbgBwIy8=
